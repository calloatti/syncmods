using UnityEngine;
using Timberborn.MainMenuPanels;
using System.Reflection;

namespace Calloatti.SyncMods
{
    public static class SyncModsPanel
    {
        // This is the flag that tells the Interceptor what to do
        public static bool IsSyncModeActive { get; set; } = false;

        public static void OnSyncButtonClicked(MainMenuPanel mainPanel)
        {
            // 1. Activate the flag
            IsSyncModeActive = true;
            Debug.Log("[SyncMods] Sync Mode Activated.");

            // 2. Open the Load Box via Reflection
            FieldInfo loadBoxField = typeof(MainMenuPanel).GetField("_loadGameBox",
                BindingFlags.NonPublic | BindingFlags.Instance);

            if (loadBoxField != null)
            {
                object loadGameBoxInstance = loadBoxField.GetValue(mainPanel);
                MethodInfo openMethod = loadGameBoxInstance.GetType().GetMethod("Open");
                openMethod?.Invoke(loadGameBoxInstance, null);
            }
        }
    }
}